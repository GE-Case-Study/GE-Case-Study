---
title: "GE Project"
output: html_document
date: "2022-11-09"
author: "Samantha Erne, Jake Holroyd, Jersie Thomas"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Creating the Tables in R

We started the project by uploading the data from the 7 CSV files that were uploaded in MySQL. 

```{r}
pacman::p_load(RMySQL)

mysqlconnection = dbConnect(
  RMySQL::MySQL(),
  dbname='gedata',
  host='mysql.fsb.miamioh.edu',
  port=3306,
  user='fsbstud',
  password='fsb4you')


dbListTables(mysqlconnection)
```

Then, we set each dataset as its own data frame in R. 

```{r}
engine_data= rbind(engine_data_aic, engine_data_axm, engine_data_fron, engine_data_pgt)
```

# Joining the esn_rul table
Now, we joined the esn_rul table to the table with all of the engine data using an inner join. 

```{r}
library(dplyr)
esn_joined_data= inner_join(engine_data, esn_rul, na_matches= 'na') # gives only training data
new_data22= left_join(engine_data, esn_rul, na_matches= 'na') # training and test data
```

# Joining the manufacturing_sql_by_esn table
We then joined the manufacturing data table to the combined table using an inner join. 

```{r}
final_data1= inner_join(esn_joined_data, manufacturing_sql_by_esn, na_matches= 'na') 
```

# Joining the lkp_airport_codes_t table
Finally, we joined the airport codes table to our combined table using a set of inner joins. We joined this table on both the depart_icao and the destination_icao columns since we need the coordinates for both airports in order to calculate the distance between airports.

```{r}
airport_depart= left_join(final_data1, lkp_airport_codes_t, by= c("depart_icao"= "airport_icao"))
airport_dest= left_join(airport_depart, lkp_airport_codes_t, by= c("destination_icao"= "airport_icao"))
airport_final= airport_dest
```

## Calculating the Distance between Airports
Next, we used the distHaversine function from the geosphere package to calculate the distance between airports. The answer gave us the distance in meters, so we converted it to miles.

```{r}
pacman::p_load(swfscMisc)
library(swfscMisc)
pacman::p_load(geosphere)
airport_final$distance= distHaversine(p1= cbind(airport_final$longitude.x, airport_final$latitude.x), p2= cbind(airport_final$longitude.y, airport_final$latitude.y))
airport_final$distance= airport_final$distance / 1000
airport_final$distance= convert.distance(airport_final$distance, from = "km", to = "nm")
```


